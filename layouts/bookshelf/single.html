{{ define "main" }}
<section id="wrapper">
<article class="h-entry post">
<section class="e-content post-body">

{{ $bookshelves_data := false }}
{{ with site.Data.plugin_bookshelves.bookshelves_data }}
{{ $bookshelves_data = . }}
{{ else }}
{{ with site.Params.bookshelves_data }}{{ $bookshelves_data = . }}{{ end }}
{{ end }}

{{ if (and $bookshelves_data (not ($bookshelves_data | reflect.IsMap))) }}
{{ with transform.Unmarshal $bookshelves_data }}
{{ $bookshelves_data = . }}
{{ end }}
{{ end }}

{{ with $bookshelves_data }}
  {{ range $bookshelf, $description := . }}
    
<p class="bookshelf-description">{{ $description | markdownify }}</p>
<div class="bookshelf-books">
    {{ range index site.Data.bookshelves $bookshelf }}

{{ partial "book.html" . }}

    {{ end }}
</div>

  {{ end }}

{{ else }}
  
 {{ range $bookshelf_key, $bookshelf := site.Data.bookshelves }}
 
<h1 class="bookshelf-key">{{ $bookshelf_key }}</h1>
<div class="bookshelf-books">
  {{ range $bookshelf }}
  
{{ partial "book.html" . }}  
  
  {{ end }}
</div>

 {{ end }}

{{ end }}

</section>
</article>
</section>

{{ end }}